---
id: Lambda-extensions
title: Lambda Extensions
overview: The Logz.io Lambda extension for logs, uses the AWS Extensions API and AWS Logs API and sends your Lambda Function Logs directly to your Logz.io account.
product: ['logs']
os: ['windows', 'linux']
filters: ['AWS', 'Compute']
logo: https://logzbucket.s3.eu-west-1.amazonaws.com/logz-docs/shipper-logos/AWS-Lambda.svg
logs_dashboards: []
logs_alerts: []
logs2metrics: []
metrics_dashboards: []
metrics_alerts: []
drop_filter: []
---

## Overview

This AWS Lambda Extension provides a streamlined way to collect telemetry data (logs, metrics, and traces) generated by your Lambda functions and the Lambda platform itself, sending it directly to your Logz.io account. It leverages the AWS Lambda Telemetry API for efficient, out-of-process data collection with minimal impact on function performance.

By using this extension, you can centralize your Lambda observability data in Logz.io without relying solely on CloudWatch Logs forwarding or complex trigger setups.

## Features

* **Comprehensive Telemetry Collection:** Subscribes to the Lambda Telemetry API to receive platform events (lifecycle, reports, errors), function logs (`stdout`/`stderr`), and extension logs.
* **Direct Logz.io Shipping:** Securely sends Logs, Metrics (Prometheus Remote Write format), and Traces (OTLP/HTTP format) to your configured Logz.io account endpoints.
* **Standard Formats & Rich Context:**
    * **Logs:** Events are processed into a structured JSON format. Log messages from your function code are automatically enriched with contextual information like `service_name`, `environment`, and the Lambda `requestId` (`faas.instance`) for easy correlation.
    * **Metrics:** Platform metrics (e.g., duration, memory usage) are converted to the Prometheus time series format. Metrics are automatically decorated with standard AWS context labels, including `service_name`, `environment`, `faas.name`, `faas.version`, and the unique `faas.execution` request ID.
    * **Traces:** The extension automatically processes X-Ray context from platform events to generate and export synthetic OpenTelemetry spans. This provides visibility into the Lambda platform's lifecycle and correlates logs with traces out-of-the-box. It also supports traces generated by instrumented function code.
* **Configurable:** Enable or disable Logs, Metrics, or Traces independently. All settings, including Logz.io region and tokens, are configured via environment variables.
* **Deployment Flexibility:** Deploy as a Lambda Layer for zip-archived functions or embed it directly into custom container images.
* **Minimal Function Impact:** Runs as a separate process within the Lambda execution environment, ensuring low overhead on your function's performance.

## Installation

There are two ways to install the extension, depending on how you deploy your Lambda function:

### **Method 1: Using Lambda Layers (Recommended for zip archives deployments)**

1.  **Find Layer ARN:** Go to the project's [**GitHub Releases Page**](https://github.com/logzio/opentelemetry-lambda-layer/releases) to find the latest `<version>` number and the complete list of Layer ARNs for all supported regions.

2.  **Use the ARN:** Copy the appropriate Layer ARN from the release page for your function's region and architecture. The ARNs follow this format:

    * For **x86_64 / amd64** architecture:
        ```
        arn:aws:lambda:<region>:486140753397:layer:logzio-otel-lambda-extension:<version>
        ```

    * For **arm64** (Graviton2) architecture:
        ```
        arn:aws:lambda:<region>:486140753397:layer:logzio-otel-lambda-extension-arm64:<version>
        ```

3.  **Add Layer:** In your Lambda function's configuration (via AWS Console, CLI, SAM, Terraform, etc.), add the Layer ARN from the releases page.

4.  **Configure Environment Variables:** Set the necessary environment variables as described in the Configuration section below.

### **Method 2: Embedding in Container Image (Recommended for container-based deployments)**

If you deploy your Lambda function using a custom container image, embed the extension directly:

1.  **Obtain Executable:** Download the pre-compiled Linux executable (`logzio-extension-amd64` or `logzio-extension-arm64`) for your function's architecture from the project's **Releases Page**.
2.  **Modify Dockerfile:** Add the following instructions to your function's `Dockerfile`:

    ```dockerfile
    # --- Add Logz.io Lambda Extension ---
    # Create the standard extensions directory
    RUN mkdir -p /opt/extensions/

    # Copy the downloaded extension executable into the directory
    # Make sure 'logzio-extension-amd64' is in the same directory as your Dockerfile or adjust the path
    COPY ./logzio-extension-amd64 /opt/extensions/logzio-extension

    # Make it executable
    RUN chmod +x /opt/extensions/logzio-extension
    # --- End Add Logz.io Lambda Extension ---

    # Your original CMD or ENTRYPOINT for your Lambda function
    # e.g., CMD [ "your_handler.handler" ]
    ```
3.  **Configure Environment Variables:** Set the necessary environment variables in your Lambda function's configuration.
4.  **Deploy:** Build and deploy your container image.

## Configuration

Configure the extension using Lambda environment variables:

| Variable                        | Required | Default             | Description                                                                                                                                                    |
| :------------------------------ | :------- | :------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `LOGZIO_APP_REGION`                 | **Yes** | `us`                | Your two-letter [Logz.io account region code](https://docs.logz.io/docs/user-guide/admin/hosting-regions/account-region/#available-regions) (e.g., `eu`, `ca`, `au`). This determines all listener URLs. |
| `LOGZIO_LOGS_TOKEN`             | If Logs  | `""`                | Your Logz.io Logs Shipping Token.                                                                                                                              |
| `LOGZIO_METRICS_TOKEN`          | If Metrics| `""`                | Your Logz.io Metrics Shipping Token (for Prometheus).                                                                                                          |
| `LOGZIO_TRACES_TOKEN`           | If Traces| `""`                | Your Logz.io Tracing Shipping Token (for OTLP).                                                                                                                |
| `LOGZIO_LOGS_ENABLED`           | No       | `true`              | Set to `false` to disable sending logs.                                                                                                                        |
| `LOGZIO_METRICS_ENABLED`        | No       | `true`              | Set to `false` to disable sending metrics.                                                                                                                     |
| `LOGZIO_TRACES_ENABLED`         | No       | `true`              | Set to `false` to disable sending traces.                                                                                                                      |
| `LOG_LEVEL`                     | No       | `info`              | Log level for the extension itself (`trace`, `debug`, `info`, `warn`, `error`).                                                                                  |
| `ENVIRONMENT`                   | No       | `""`                | Deployment environment (e.g., `prod`, `dev`). Added as a `deployment.environment` attribute to all telemetry.                                                    |
| `OTEL_SERVICE_NAME`             | No       | (AWS Function Name) | Service name for all telemetry. Defaults to `AWS_LAMBDA_FUNCTION_NAME`. Setting this explicitly is recommended.                                                  |
| `LOGZIO_METRIC_LABELS`          | No       | `""`                | Comma-separated `key=value` pairs for custom static metric labels (e.g., `team=backend,app=my-app`).                                                             |
| `LOGZIO_DRAIN_DURATION_SECONDS` | No       | `2s`                | How often the internal log buffer flushes to Logz.io. Must include a unit (e.g., `2s`, `500ms`).                                                                |
| `DISPATCH_MIN_BATCH_SIZE`       | No       | `1`                 | Minimum number of events the dispatcher processes before sending (unless forced).                                                                              |
| `DISPATCH_MAX_BATCH_SIZE`       | No       | `1000`              | Maximum number of events the dispatcher will pull from the queue in a single cycle.                                                                            |
| `LISTENER_QUEUE_SIZE`           | No       | `2048`              | Size of the internal buffer between the listener and dispatcher. Increase if seeing `platform.logsDropped` frequently.                                         |

**Note on CloudWatch Costs:** This extension sends data directly to Logz.io *in addition to* standard AWS mechanisms. To avoid duplicate data ingestion costs from CloudWatch, you can prevent your function from sending logs to CloudWatch Logs by removing the `logs:CreateLogStream` and `logs:PutLogEvents` permissions from its IAM execution role.

## Supported Runtimes

This extension works with all AWS Lambda runtimes that support Lambda Extensions, including custom runtimes and container images.

## Building from Source

Ensure you have Go installed (version 1.21 or higher recommended).

1.  **Clone the repository:**
    ```bash
    git clone [https://github.com/logzio/opentelemetry-lambda-layer.git](https://github.com/logzio/opentelemetry-lambda-layer.git)
    cd opentelemetry-lambda-layer
    ```
2.  **Build:** Use the provided Makefile.
    * For `x86_64` (Intel/AMD) Lambda functions:
        ```bash
        make build-linux-amd64
        ```
    * For `arm64` (Graviton2) Lambda functions:
        ```bash
        make build-linux-arm64
        ```
    The compiled executable will be in the `bin/` directory.